{% extends 'base.html' %}
{% block title %}My Book Requests - LearnCycle{% endblock %}

{% block content %}
<div class="min-h-screen flex items-start justify-center py-12 px-4 sm:px-6 lg:px-8 bg-gradient-to-b from-white to-slate-50 relative overflow-hidden">

  <!-- Soft background animation -->
  <div class="absolute inset-0 -z-10">
    <div class="absolute w-72 h-72 bg-emerald-300/30 rounded-full blur-3xl top-16 left-12 animate-pulse"></div>
    <div class="absolute w-96 h-96 bg-teal-300/30 rounded-full blur-3xl bottom-16 right-12 animate-pulse"></div>
  </div>

  <!-- Main Container -->
  <div class="max-w-5xl w-full bg-white/80 backdrop-blur-sm border border-slate-200 rounded-3xl shadow-xl p-8 animate-fade-in">

    <!-- Header -->
    <h2 class="text-3xl font-extrabold text-slate-800 mb-8 text-center">My Book Requests</h2>

    {% if requests %}
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        {% for request in requests %}
        <div class="p-6 bg-slate-50 border border-slate-200 rounded-2xl shadow-sm hover:shadow-md transition transform hover:-translate-y-1">

          <!-- Title and Author -->
          <h3 class="text-xl font-semibold text-slate-800 mb-1">{{ request.title }}</h3>
          <p class="text-gray-600 mb-2">by {{ request.author }}</p>

          <!-- Category -->
          <p class="text-sm text-gray-600 mb-1">
            Category:
            <span class="font-medium text-emerald-700">
              {% if request.category %}{{ request.category.name }}{% else %}N/A{% endif %}
            </span>
          </p>
          

          <!-- Description -->
          {% if request.description %}
          <p class="text-sm text-gray-600 mb-2">
            Description:
            <span class="text-gray-500">{{ request.description|truncatewords:20 }}</span>
          </p>
          {% endif %}

          

          <!-- Status -->
          <p class="text-sm mt-2">
            <strong>Status:</strong>
            {% if request.is_fulfilled %}
              <span class="text-green-600 font-semibold">Fulfilled</span>
            {% else %}
              <span class="text-amber-500 font-semibold">Pending</span>
            {% endif %}
          </p>
          <!-- Matched Book Link -->
          {% if request.is_fulfilled and request.matched_book %}
          <p class="text-sm mt-1">
            <strong>Matched Book:</strong>
            <a href="{% url 'books:book_detail' request.matched_book.id %}" class="text-blue-600 hover:underline font-medium">
              {{ request.matched_book.title }}
            </a>
          </p>
          {% endif %}

          <p class="text-xs text-gray-400 mt-1">Submitted on {{ request.created_at|date:"M d, Y" }}</p>

          <!-- Seller's Reply -->
          {% if request.reply_message %}
          <div class="mt-4 p-3 bg-emerald-50 border border-emerald-100 rounded-xl">
            <h4 class="font-semibold text-emerald-700 mb-1">Seller's Reply:</h4>
            <p class="text-gray-700">{{ request.reply_message }}</p>
            {% if request.replied_at %}
            <p class="text-xs text-gray-400 mt-1">Replied on: {{ request.replied_at|date:"M d, Y, g:i A" }}</p>
            {% endif %}
          </div>
          {% endif %}

          <!-- Reply Form (if allowed) -->
          {% if not request.is_fulfilled and request.reply_message %}
          <div class="mt-4">
            <form method="POST" action="{% url 'requests:reply_to_request' request.id %}">
              {% csrf_token %}
              <textarea name="reply_message" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg mb-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500" placeholder="Enter your reply..."></textarea>
              <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg shadow-md transition">
                Send Reply
              </button>
            </form>
          </div>
          {% endif %}

        </div>
        {% endfor %}
      </div>
    {% else %}
      <!-- Empty State -->
      <div class="text-center py-16">
        <p class="text-gray-500 text-lg mb-4">You haven’t requested any books yet.</p>
        <a href="{% url 'requests:request_book' %}" 
           class="inline-block bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white font-semibold px-6 py-3 rounded-xl shadow-md transition-transform transform hover:scale-105">
           Request Your First Book
        </a>
      </div>
    {% endif %}

    <!-- Footer Buttons -->
    <div class="mt-10 flex flex-wrap gap-4 justify-center">
      <a href="{% url 'requests:request_book' %}" class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white font-semibold shadow transition transform hover:scale-105">
        Request a New Book
      </a>
      <a href="{% url 'books:book_list' %}" class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-white border border-slate-200 hover:shadow text-slate-700 transition transform hover:scale-105">
        ← Back to Books
      </a>
    </div>
  </div>
</div>

<style>
@keyframes fade-in {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}
.animate-fade-in {
  animation: fade-in 0.8s ease-out both;
}
</style>
{% endblock %}
