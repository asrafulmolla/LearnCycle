{% extends 'base.html' %}
{% block title %}Digital Library - LearnCycle{% endblock %}

{% block content %}
<style>
@keyframes float {
  0%, 100% { transform: translateY(0px) rotate(0deg); }
  50% { transform: translateY(-20px) rotate(2deg); }
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(50px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes shimmer {
  0% { background-position: -1000px 0; }
  100% { background-position: 1000px 0; }
}

@keyframes glow {
  0%, 100% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.3), 0 0 40px rgba(20, 184, 166, 0.1); }
  50% { box-shadow: 0 0 30px rgba(16, 185, 129, 0.5), 0 0 60px rgba(20, 184, 166, 0.2); }
}

@keyframes flip-in {
  0% { transform: rotateY(90deg) scale(0.5); opacity: 0; }
  100% { transform: rotateY(0deg) scale(1); opacity: 1; }
}

@keyframes book-float {
  0%, 100% { transform: translateY(-5px); }
  50% { transform: translateY(5px); }
}

@keyframes pulse-scale {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

@keyframes text-gradient {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}

@keyframes gradient-shift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

@keyframes bounce-in {
  0% { transform: scale(0) translateY(20px); opacity: 0; }
  50% { transform: scale(1.1); }
  100% { transform: scale(1) translateY(0); opacity: 1; }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}

.animate-fadeInUp {
  animation: fadeInUp 0.8s ease-out forwards;
}

.animate-slideUp {
  animation: slideUp 0.8s ease-out forwards;
}

.animate-flip-in {
  animation: flip-in 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

.animate-book-float {
  animation: book-float 3s ease-in-out infinite;
}

.animate-bounce-in {
  animation: bounce-in 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

.shimmer-effect {
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
  background-size: 200% 100%;
  animation: shimmer 3s infinite;
}

.glow-effect {
  animation: glow 3s ease-in-out infinite;
}

.text-animate-gradient {
  background: linear-gradient(90deg, #1f2937, #10b981, #14b8a6, #1f2937);
  background-size: 300% 100%;
  animation: text-gradient 8s ease infinite;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.book-card {
  position: relative;
  overflow: hidden;
  transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
}

.book-card::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(20, 184, 166, 0.1));
  opacity: 0;
  transition: opacity 0.5s ease;
  z-index: 1;
}

.book-card:hover::before {
  opacity: 1;
}

.book-card:hover {
  transform: translateY(-12px) scale(1.02);
  box-shadow: 0 20px 50px rgba(16, 185, 129, 0.25);
}

.book-cover {
  position: relative;
  overflow: hidden;
  height: 250px;
}

.book-cover::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
  background-size: 200% 100%;
  animation: shimmer 3s infinite;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.book-card:hover .book-cover::after {
  opacity: 1;
}

.book-cover img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
}

.book-card:hover .book-cover img {
  transform: scale(1.12) rotate(2deg);
  filter: brightness(1.1);
}

.book-info {
  position: relative;
  z-index: 2;
}

.btn-view {
  position: relative;
  overflow: hidden;
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  background-size: 200% 100%;
  animation: gradient-shift 3s ease infinite;
}

.btn-view::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
  background-size: 200% 100%;
  animation: shimmer 3s infinite;
}

.btn-view span {
  position: relative;
  z-index: 2;
}

.header-badge {
  animation: bounce-in 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.no-books {
  animation: fadeInUp 1s ease-out;
}

.back-button {
  transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
}

.back-button:hover {
  transform: translateX(-4px) translateY(-2px);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}
</style>

<div class="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-emerald-50 relative overflow-hidden py-16 px-6 sm:px-10 lg:px-20">
  <!-- Animated Background Elements -->
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <div class="absolute top-20 left-10 w-64 h-64 bg-emerald-200/20 rounded-full blur-3xl animate-float" style="animation-delay: 0s;"></div>
    <div class="absolute top-40 right-20 w-96 h-96 bg-teal-200/20 rounded-full blur-3xl animate-float" style="animation-delay: 2s;"></div>
    <div class="absolute bottom-20 left-1/3 w-80 h-80 bg-blue-200/20 rounded-full blur-3xl animate-float" style="animation-delay: 4s;"></div>
  </div>

  <div class="relative z-10">
    <!-- Header Section -->
    <div class="max-w-6xl mx-auto text-center mb-16 animate-fadeInUp">
      <!-- Header Badge -->
      <div class="header-badge inline-flex items-center gap-3 bg-white/80 backdrop-blur-md border border-emerald-200 rounded-full px-6 py-3 mb-6">
        <span class="w-3 h-3 bg-emerald-500 rounded-full animate-pulse"></span>
        <span class="text-sm font-semibold text-emerald-700">Digital Library</span>
      </div>

      <!-- Main Title -->
      <h1 class="text-5xl sm:text-6xl font-black text-animate-gradient mb-4 tracking-tight">
        Digital Library
      </h1>

      <!-- Subtitle -->
      <p class="text-slate-600 text-lg max-w-3xl mx-auto leading-relaxed">
        Explore and download eBooks, notes, and learning materials in PDF format. Expand your knowledge anytime, anywhere. Access premium educational content from our curated collection.
      </p>
    </div>

    {% if ebooks %}
      <!-- Books Grid -->
      <div class="max-w-6xl mx-auto">
        <div class="grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
          {% for book in ebooks %}
            <div class="animate-slideUp book-card bg-white/95 backdrop-blur-xl border-2 border-slate-200 rounded-3xl overflow-hidden shadow-lg" style="animation-delay: {{ forloop.counter|stringformat:'d'|add:' ' }}00ms;">
              
              <!-- Book Cover -->
              <div class="book-cover bg-gradient-to-br from-slate-200 to-slate-300">
                {% if book.cover_image %}
                  <img src="{{ book.cover_image.url }}" alt="{{ book.title }}" class="animate-book-float">
                {% else %}
                  <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-emerald-400 to-teal-600">
                    <svg class="w-24 h-24 text-white opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6.253v13m0-13C6.5 6.253 2 10.998 2 17s4.5 10.747 10 10.747c5.5 0 10-4.996 10-10.747S17.5 6.253 12 6.253z"></path>
                    </svg>
                  </div>
                {% endif %}
              </div>

              <!-- Book Info -->
              <div class="book-info p-6 md:p-8">
                <!-- Title -->
                <h3 class="text-xl md:text-2xl font-bold text-slate-800 group-hover:text-emerald-700 transition-colors line-clamp-2 mb-2">{{ book.title }}</h3>

                <!-- Author -->
                <p class="text-sm text-slate-600 font-medium mb-1">by {{ book.author }}</p>

                <!-- Upload Info -->
                <p class="text-xs text-slate-500 mb-6 pb-6 border-b border-slate-100">
                  <span class="inline-block">Uploaded on {{ book.uploaded_at|date:"M d, Y" }}</span>
                  <span class="inline-block ml-2">by {{ book.uploaded_by.username }}</span>
                </p>

                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row gap-3">
                  <a href="{% url 'library_download' book.pk %}" target="_blank" class="flex-1 text-center btn-view px-4 py-3 rounded-xl text-white font-bold shadow-lg hover:shadow-2xl transition-all transform hover:-translate-y-1 hover:scale-105 active:scale-100 overflow-hidden relative group">
                    <span class="absolute inset-0 w-full h-full bg-gradient-to-r from-transparent via-white/30 to-transparent transform -translate-x-full group-hover:translate-x-full transition-transform duration-1000 ease-out"></span>
                    <span class="relative flex items-center justify-center gap-2">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                      </svg>
                      View PDF
                    </span>
                  </a>
                  
                  <a href="{% url 'library_download' book.pk %}" download class="flex-1 text-center px-4 py-3 rounded-xl border-2 border-emerald-300 bg-white hover:bg-emerald-50 text-emerald-700 font-bold shadow-lg hover:shadow-2xl transition-all transform hover:-translate-y-1 hover:scale-105 active:scale-100 group relative overflow-hidden">
                    <span class="absolute inset-0 bg-gradient-to-r from-emerald-500/10 to-teal-500/10 opacity-0 group-hover:opacity-100 transition-opacity"></span>
                    <span class="relative flex items-center justify-center gap-2">
                      <svg class="w-5 h-5 group-hover:animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                      </svg>
                      Download
                    </span>
                  </a>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    {% else %}
      <!-- No Books Message -->
      <div class="no-books max-w-2xl mx-auto text-center py-20">
        <div class="mb-6">
          <svg class="w-24 h-24 mx-auto text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6.253v13m0-13C6.5 6.253 2 10.998 2 17s4.5 10.747 10 10.747c5.5 0 10-4.996 10-10.747S17.5 6.253 12 6.253z"></path>
          </svg>
        </div>
        <p class="text-slate-500 text-xl font-semibold">No digital books available yet.</p>
        <p class="text-slate-400 mt-2">Check back soon for our curated collection of eBooks and learning materials.</p>
      </div>
    {% endif %}

    <!-- Back Button -->
    <div class="max-w-6xl mx-auto text-center mt-16 animate-fadeInUp" style="animation-delay: 0.3s;">
      <a href="{% url 'book_list' %}" class="inline-flex items-center gap-2 px-6 py-4 rounded-xl bg-white border-2 border-slate-200 hover:border-slate-300 hover:bg-slate-50 shadow-lg hover:shadow-xl text-slate-700 font-bold transition-all back-button glow-effect">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
        </svg>
        Back to Books
      </a>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Add staggered animation delay to book cards
  const bookCards = document.querySelectorAll('.book-card');
  bookCards.forEach((card, index) => {
    card.style.animationDelay = `${0.2 + index * 0.1}s`;
  });

  // Add ripple effect to buttons
  const buttons = document.querySelectorAll('.btn-view, [download]');
  buttons.forEach(button => {
    button.addEventListener('click', function(e) {
      const ripple = document.createElement('span');
      const rect = this.getBoundingClientRect();
      const size = Math.max(rect.width, rect.height);
      const x = e.clientX - rect.left - size / 2;
      const y = e.clientY - rect.top - size / 2;

      ripple.style.width = ripple.style.height = size + 'px';
      ripple.style.left = x + 'px';
      ripple.style.top = y + 'px';
      ripple.style.position = 'absolute';
      ripple.style.borderRadius = '50%';
      ripple.style.background = 'rgba(255, 255, 255, 0.5)';
      ripple.style.pointerEvents = 'none';
      ripple.style.animation = 'ripple 0.6s ease-out';
      ripple.style.zIndex = '1';

      this.style.position = 'relative';
      this.style.overflow = 'hidden';
      this.appendChild(ripple);

      setTimeout(() => ripple.remove(), 600);
    });
  });

  // Add CSS animation for ripple
  const style = document.createElement('style');
  style.textContent = `
    @keyframes ripple {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }
  `;
  document.head.appendChild(style);
});
</script>

{% endblock %}